<!DOCTYPE html>
<html>
<head>
    <title>Котик vs Песик</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>
    <style>
        body { font-family: Arial; text-align: center; padding: 20px; }
        #preview { max-width: 300px; margin: 20px auto; }
        #result { font-size: 20px; color: #333; }
    </style>
</head>
<body>

<h2>Загрузите фото котика или песика</h2>
<input type="file" id="upload" accept="image/*">
<div id="preview"></div>
<div id="result"></div>

<script>
    const modelURL = 'https://mhan7904.github.io/cat-dog-classifier/model.json';
    const metadataURL = 'https://mhan7904.github.io/cat-dog-classifier/metadata.json';
    let model;

    async function init() {
        try {
            model = await tmImage.load(modelURL, metadataURL);
            console.log("Модель загружена!");
        } catch (error) {
        console.error("Ошибка загрузки модели:", error);
        alert("Ошибка загрузки модели. Проверьте консоль.");
    }
        
    document.getElementById('upload').addEventListener('change', async (e) => {
        if (!model) { // Добавить эту проверку
        alert("Модель еще не загрузилась! Подождите...");
        return;
        }
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = async (event) => {
            const img = new Image();
            img.src = event.target.result;
            
            img.onload = async () => {
                try {
                    // Показываем превью
                    document.getElementById('preview').innerHTML = `<img src="${img.src}" style="max-width:100%">`;
                
                    // Делаем предсказание
                    const prediction = await model.predict(img);
                    const result = prediction.sort((a, b) => b.probability - a.probability)[0];
                
                    // Выводим результат
                    document.getElementById('result').innerHTML = `
                        Это <strong>${result.className}</strong> с вероятностью ${Math.round(result.probability * 100)}%!
                    `;
                    } catch (error) {
                    console.error("Ошибка предсказания:", error);
                    alert("Ошибка обработки изображения");
                } finally {
                    URL.revokeObjectURL(img.src);
                }
                    };
            };
            reader.readAsDataURL(file);
        });

    init();
</script>

</body>
</html>
